(function(){function e(e){return e instanceof E.selection?e:E.select(e)}function t(e,t,n){n.forEach(function(n){e[n]=function(r){return arguments.length?(t[n]=r,e):n in t?t[n]:i(e,n)}})}function n(e,t,n){e[t]=function(){var t=T(arguments);return t.length?(t=A(t[0])?t[0]:t,n.forEach(function(n,r){e[n](t[r])}),e):n.map(function(t){return e[t]()})}}function r(e){e.element=function(t,n){if(j.indexOf(t)===-1)throw new Error("Unknown element type: '"+t+"'");return e[t](n)}}function i(e,t){var n=e.group?e.group():S;return C(n[t])?n[t]():null}function s(e,t){return N(t).forEach(function(n){e[n]=t[n]}),e}function o(e){return s({},e)}function u(e,t){return k(t)&&N(t).forEach(function(n){if(!C(e[n]))throw new Error("Uknown method: '"+n+"'");e[n](t[n])}),e}function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}function f(e){var t=a(e);return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}function l(e){return e===undefined}function c(e){return function(t){return t[e]}}function h(e,t){return function(n){return e(t(n))}}function p(e,t){var n=t?e.value().map(t):e.domain();return n[0]instanceof Date?E.time.scale().domain(E.extent(n)):typeof n[0]=="string"?E.scale.ordinal().domain(n):E.scale.linear().domain(E.extent(n))}function d(e,t){var n=e.xAxis(),r=E.extent(t.all(),c("key")),i=r[1]-r[0],s,o,u;if(r[0]instanceof Date){var a=e.width()/70;i<B?(s=_,o=E.time.hours,u=i/H):i<B*180?(s=M,o=E.time.days,u=i/B):(s=O,o=E.time.months,u=i/B*30),n.tickFormat(s),n.ticks(o,Math.floor(u/a)+1)}}function v(e,t,n,r){return{top:e,right:t,bottom:n,left:r}}function m(e,t){e.padding=function(n){return arguments.length?(k(n)?s(t.padding||v(0,0,0,0),n):isNaN(n)||(t.padding=v(+n,+n,+n,+n)),e):t.padding}}function g(e){var t=i(e,"baseSize"),n=i(e,"margins");return{top:t[0]*(e.top?+e.top():0)+n,left:t[1]*(e.left?+e.left():0)+n,height:t[0]*+e.height()-n*2,width:t[1]*+e.width()-n*2}}function y(e,t){return t=t||geomentry(e).height,e.header()&&(t-=e.headerPadding()),e.footer()&&(t-=e.footerPadding()),t}function b(e,n){var r={range:null};N(e).forEach(function(t){t!=="all"&&e.hasOwnProperty(t)&&(this[t]=function(){return e[t].apply(e,arguments)})},this),this.all=function(){var t=e.all(),i=r.range;return A(i)?t.filter(function(e){return n(e)>=i[0]&&n(e)<i[1]}):t},t(this,r,["range"])}var w=this,E=w.d3,S={version:"0.1.2"},x={baseWidth:1,baseHeight:1,margins:0,headerPadding:50,footerPadding:50};t(S,x,Object.keys(x)),n(S,"baseSize",["baseHeight","baseWidth"]),S.config=function(e){return arguments.length?u(S,e):o(x)};var T=Function.prototype.call.bind(Array.prototype.slice),N=Object.keys,C=f("function"),k=f("object"),L=f("date"),A=Array.isArray,O=E.time.format("%b"),M=function(e){return e.getMonth()+1+"/"+e.getDate()},_=E.time.format("%I%p"),D=1e3,P=60*D,H=60*P,B=24*H;r(S);var j=[];S.defineElement=function(r,i){if(S[r])throw new Error("Attempting to define element that already exists or is protected: '"+r+"'");j.push(r),S[r]=function(s){var o,a={height:200,width:200},f=function(t){var n=g(f),i=e(t).append("div");return i.classed("element element-"+r,!0).style("height",n.height+"px").style("width",n.width+"px"),f.header()&&i.append("header").html(f.header()),i.append("div").classed("content",!0).call(o),f.footer()&&i.append("footer").html(f.footer()),f};return f.render=f,t(f,a,["metric","width","height","header","footer","headerPadding","footerPadding"]),n(f,"size",["height","width"]),o=i(f),u(f,s)}},S.group=function(){var i,s,a=[];return i=function(t){var n=e(t).append("div").classed("informant group",!0).style("position","relative");return a.forEach(function(e){var t=g(e),r=n.append("div");r.style("position","absolute").style("top",t.top+"px").style("left",t.left+"px").classed("wrapper",!0).call(e),e.id()&&r.attr("id",e.id()),e.classes()&&r.classed(e.classes(),!0)}),n},j.forEach(function(e){i[e]=function(r){var s=S[e](),o={top:0,left:0};return a.push(s),t(s,o,["id","classes","top","left"]),n(s,"position",["top","left"]),s.end=s.group=function(){return i},u(s,r),l(r)?s:i}}),s=o(x),t(i,s,N(x)),n(i,"baseSize",["baseHeight","baseWidth"]),r(i),i.render=i,i},S.defineElement("html",function(e){var n={content:""};return t(e,n,["content"]),delete e.metric,function(t){t.html(e.content())}}),S.defineElement("number",function(e){return function(t){var n=e.metric(),r=t.append("div").classed("value",!0);n.on("change",function(){r.text(n.value())})}}),S.defineElement("list",function(e){var n={keyAccessor:c("key"),valueAccessor:c("value"),numbered:!1,showValues:!1};return t(e,n,["keyAccessor","valueAccessor","numbered","showValues"]),function(t){var n=e.metric(),r=!!n.dimension(),i=e.keyAccessor(),s=e.valueAccessor(),o=t.append(e.numbered()?"ol":"ul");n.on("change",function(){var u=o.selectAll("li").data(n.value());u.enter().append("li").call(function(t){t.append("span").attr("class","key"),e.showValues()&&t.append("span").attr("class","value")}),u.call(function(t){t.select("span.key").text(i),e.showValues()&&t.select("span.value").text(s)}),r&&(o.classed("filterable",!0),u.classed("selected",function(e){return i(e)===n.filter()}).on("click",function(e){n.filter(i(e)===n.filter()?null:i(e)),dc&&dc.redrawAll()})),u.exit().remove()})}}),S.defineElement("filter",function(e){var n={source:null,filters:[],accessor:c("key")},r=[{days:90,name:"90 Day"},{days:30,name:"30 Day"},{days:7,name:"Week"},{days:1,name:"Day"}],i=864e5,s=c("filter");return t(e,n,["source","filters","accessor"]),function(t){function n(){a.selectAll("li").classed("selected",function(e){return s(e)===o.filter()})}var o=e.metric(),u=e.filters(),a=t.append("ul");if(!o){if(!e.source())throw new Error("A metric or source must be specified in a filter");o=e.source().metric().byDate()}o.on("ready",function(){if(!u.length){var f=E.extent(o.value(),e.accessor()),l=new Date(+f[1]+1),h=[f[0],l];u.push({name:"All",filter:h}),r.forEach(function(e){f[1]-f[0]>=i*e.days&&u.push({name:e.name,filter:[new Date(f[1]-i*e.days),l]})}),o.filter(h)}a.selectAll("li").data(u).enter().append("li").text(c("name")).on("click",function(e){var t=s(e);t!==o.filter()&&(o.filter(t),dc&&dc.redrawAll())}),n()}),o.on("filter",n)}}),S.defineElement("graph",function(e){var n={keyAccessor:c("key"),valueAccessor:c("value"),padding:v(10,30,30,50)};return t(e,n,["keyAccessor","valueAccessor"]),m(e,n),function(t){var r,i=e.metric(),s=i.group(),o=new b(s,n.keyAccessor),u=g(e),a=t.append("div").classed("chart line-chart",!0);i.on("ready",function(){r=dc.lineChart(a.node()).width(u.width).height(y(e,u.height)).margins(e.padding()).dimension(i.dimension()).group(o).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(p(i)),r.elasticY(!0).elasticX(!0).renderHorizontalGridLines(!0).brushOn(!1).renderArea(!0),d(r,o),r.render()}),i.on("filter",function(e,t){var i=s.all();A(t)&&L(t[0])&&A(i)&&L(n.keyAccessor(i[0]))&&(o.range(t),r&&d(r,o))})}}),S.defineElement("bar",function(e){var n={keyAccessor:c("key"),valueAccessor:c("value"),padding:v(10,30,30,50)};return t(e,n,["keyAccessor","valueAccessor"]),m(e,n),function(t){var r=e.metric(),i=r.group(),s=new b(i,n.keyAccessor),o=g(e),u=t.append("div").classed("chart bar-chart",!0);r.on("ready",function(){var i=dc.barChart(u.node()).width(o.width).height(y(e,o.height)).margins(e.padding()).dimension(r.dimension()).group(s).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(p(r)).xUnits(dc.units.ordinal);i.elasticY(!0).elasticX(!0).centerBar(!0).renderHorizontalGridLines(!0).brushOn(!1),i.render()}),r.on("filter",function(e,t){var r=i.all();A(t)&&L(t[0])&&A(r)&&L(n.keyAccessor(r[0]))&&s.range(t)})}}),S.defineElement("pie",function(e){var n={donut:!1,padding:10};return t(e,n,["donut","padding"]),function(t){var n=e.metric(),r=g(e),i=t.append("div").classed("chart pie-chart",!0);n.on("ready",function(){var s=Math.min(r.width,y(e,r.height))/2-e.padding(),o=E.scale.linear().domain([0,n.group().size()-1]).range(["rgba(0,0,0,0.2)","rgba(0,0,0,0.7)"]),u=dc.pieChart(i.node()).width(r.width).height(y(e,r.height)).radius(s).dimension(n.dimension()).group(n.group());e.donut()&&u.innerRadius(s/3),u.minAngleForLabel(.05);var a=[];for(var f=0,l=n.group().size();f<l;f++)a.push(f);u.colors(a.map(o)),u.render()})}}),S.defineElement("bubble",function(e){var n=c("value"),r={keyAccessor:c("key"),valueAccessor:c("value"),radiusAccessor:c("radius"),padding:v(10,30,30,50)};return t(e,r,["keyAccessor","valueAccessor","radiusAccessor"]),m(e,r),function(t){var r=e.metric(),i=g(e),s=h(e.keyAccessor(),n),o=h(e.valueAccessor(),n),u=h(e.radiusAccessor(),n),a=t.append("div").classed("chart bubble-chart",!0);r.on("ready",function(){var n=dc.bubbleChart(a.node()).width(i.width).height(y(e,i.height)).margins(e.padding()).dimension(r.dimension()).group(r.group()).x(p(r,s)).y(p(r,o)).r(p(r,u)).keyAccessor(s).valueAccessor(o).radiusValueAccessor(u);n.colors(E.scale.category20c()).maxBubbleRelativeSize(.09).renderLabel(!0).elasticX(!0).elasticY(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).brushOn(!1),n.render()})}}),E.interpolators.push(function(e,t){function n(e,t){return E.range(t).map(function(){return e})}function r(e){return e.substr(1,e.length-(u?2:1)).split("L")}function i(e){return"M"+e.join("L")+(u?"Z":"")}function s(e,t){var r=t.length-e.length;return u?n(e[0],r/2).concat(e,n(e[e.length-1],r/2)):n(e[0],r).concat(e)}var o,u,a,f,l,c,h;o=/M-?\d*\.?\d*,-?\d*\.?\d*(L-?\d*\.?\d*,-?\d*\.?\d*)*Z?/;if(o.test(e)&&o.test(t))return u=e[e.length-1]==="Z",f=r(e),l=r(t),c=f.length,h=l.length,c>h&&(l=s(l,f)),h>c&&(f=s(f,l)),a=E.interpolateString(h>c?i(f):e,c>h?i(l):t),h>c?a:function(e){return e===1?t:a(e)}}),typeof module!="undefined"?module.exports=S:typeof define=="function"&&define.amd?define("informant",function(){return S}):w.informant=S})();