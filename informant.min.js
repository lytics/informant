(function(){function e(e){return e instanceof E.selection?e:E.select(e)}function t(e,t,n){n.forEach(function(n){e[n]=function(r){return arguments.length?(t[n]=r,e):t[n]}})}function n(e,t,n){e[t]=function(){var t=d(arguments);return t.length?(t=b(t[0])?t[0]:t,n.forEach(function(n,r){e[n](t[r])}),e):n.map(function(t){return e[t]()})}}function r(e){e.element=function(t,n){if(T.indexOf(t)===-1)throw new Error("Unknown element type: '"+t+"'");return e[t](n)}}function i(e,t){return v(t).forEach(function(n){e[n]=t[n]}),e}function s(e,t){return g(t)&&v(t).forEach(function(n){if(!m(e[n]))throw new Error("Uknown method: '"+n+"'");e[n](t[n])}),e}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}function u(e){var t=o(e);return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}function a(e){return e===undefined}function f(e){return function(t){return t[e]}}function l(e,t){return function(n){return e(t(n))}}function c(e,t){var n=t?e.value().map(t):e.domain();return n[0]instanceof Date?E.time.scale().domain(E.extent(n)):typeof n[0]=="string"?E.scale.ordinal().domain(n):E.scale.linear().domain(E.extent(n))}function h(e){var t=S.baseSize(),n=S.margins();return{top:t[0]*(e.top?+e.top():0)+n,left:t[1]*(e.left?+e.left():0)+n,height:t[0]*+e.height()-n*2,width:t[1]*+e.width()-n*2}}function p(e,n){var r={range:null};v(e).forEach(function(t){t!=="all"&&e.hasOwnProperty(t)&&(this[t]=function(){return e[t].apply(e,arguments)})},this),this.all=function(){var t=e.all(),i=r.range;return b(i)?t.filter(function(e){return n(e)>=i[0]&&n(e)<i[1]}):t},t(this,r,["range"])}var d=Function.prototype.call.bind(Array.prototype.slice),v=Object.keys,m=u("function"),g=u("object"),y=u("date"),b=Array.isArray,w=this,E=w.d3,S={version:"0.1.0"},x={baseWidth:1,baseHeight:1,margins:0};t(S,x,v(x)),n(S,"baseSize",["baseHeight","baseWidth"]),r(S),S.config=function(e){return arguments.length?s(S,e):i({},x)};var T=[];S.defineElement=function(r,i){if(S[r])throw new Error("Attempting to define element that already exists or is protected: '"+r+"'");T.push(r),S[r]=function(o){var u,a={height:200,width:200},f=function(t){var n=h(f),i=e(t).append("div");return i.classed("element element-"+r,!0).style("height",n.height+"px").style("width",n.width+"px"),f.header()&&i.append("header").html(f.header()),i.append("div").classed("content",!0).call(u),f.footer()&&i.append("footer").html(f.footer()),f};return f.render=f,t(f,a,["metric","width","height","header","footer"]),n(f,"size",["height","width"]),u=i(f),s(f,o)}},S.group=function(){var i,o=[];return i=function(t){var n=e(t).append("div").classed("informant group",!0).style("position","relative");return o.forEach(function(e){var t=h(e),r=n.append("div");r.style("position","absolute").style("top",t.top+"px").style("left",t.left+"px").classed("wrapper",!0).call(e),e.id()&&r.attr("id",e.id()),e.classes()&&r.classed(e.classes(),!0)}),n},T.forEach(function(e){i[e]=function(r){var u=S[e](),f={top:0,left:0};return o.push(u),t(u,f,["id","classes","top","left"]),n(u,"position",["top","left"]),u.end=function(){return i},s(u,r),a(r)?u:i}}),r(i),i.render=i,i},E.interpolators.push(function(e,t){function n(e,t){return E.range(t).map(function(){return e})}function r(e){return e.substr(1,e.length-(u?2:1)).split("L")}function i(e){return"M"+e.join("L")+(u?"Z":"")}function s(e,t){var r=t.length-e.length;return u?n(e[0],r/2).concat(e,n(e[e.length-1],r/2)):n(e[0],r).concat(e)}var o,u,a,f,l,c,h;o=/M-?\d*\.?\d*,-?\d*\.?\d*(L-?\d*\.?\d*,-?\d*\.?\d*)*Z?/;if(o.test(e)&&o.test(t))return u=e[e.length-1]==="Z",f=r(e),l=r(t),c=f.length,h=l.length,c>h&&(l=s(l,f)),h>c&&(f=s(f,l)),a=E.interpolateString(h>c?i(f):e,c>h?i(l):t),h>c?a:function(e){return e===1?t:a(e)}}),S.defineElement("number",function(e){return function(t){var n=e.metric(),r=t.append("div").classed("value",!0);n.on("change",function(){r.text(n.value())})}}),S.defineElement("list",function(e){var n={numbered:!1,accessor:f("key")};return t(e,n,["numbered","accessor"]),function(t){var n=e.metric(),r=e.accessor(),i=t.append(e.numbered()?"ol":"ul");n.on("change",function(){var t=i.selectAll("li").data(n.value());t.enter().append("li"),t.text(r).classed("selected",function(e){return r(e)===n.filter()}).on("click",function(e){n.filter(r(e)===n.filter()?null:r(e)),dc&&dc.redrawAll()}),t.exit().remove()})}}),S.defineElement("filter",function(e){var n={source:null,filters:[],accessor:f("key")},r=[{days:90,name:"90 Day"},{days:30,name:"30 Day"},{days:7,name:"Week"},{days:1,name:"Day"}],i=864e5,s=f("filter");return t(e,n,["source","filters","accessor"]),function(t){function n(){a.selectAll("li").classed("selected",function(e){return s(e)===o.filter()})}var o=e.metric(),u=e.filters(),a=t.append("ul");if(!o){if(!e.source())throw new Error("A metric or source must be specified in a filter");o=e.source().metric().byDate()}o.on("ready",function(){if(!u.length){var l=E.extent(o.value(),e.accessor()),c=new Date(+l[1]+1),h=[l[0],c];u.push({name:"All",filter:h}),r.forEach(function(e){l[1]-l[0]>=i*e.days&&u.push({name:e.name,filter:[new Date(l[1]-i*e.days),c]})}),o.filter(h)}a.selectAll("li").data(u).enter().append("li").text(f("name")).on("click",function(e){var t=s(e);o.filter(t===o.filter()?null:t),dc&&dc.redrawAll()}),n()}),o.on("filter",n)}}),S.defineElement("graph",function(e){var n={keyAccessor:f("key"),valueAccessor:f("value")};return t(e,n,["keyAccessor","valueAccessor"]),function(t){var r=e.metric(),i=r.group(),s=new p(i,n.keyAccessor),o=h(e),u=t.append("div").classed("chart line-chart",!0);r.on("ready",function(){var t=dc.lineChart(u.node()).width(o.width-40).height(o.height-140).margins({top:10,right:10,bottom:30,left:50}).dimension(r.dimension()).group(s).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(c(r));t.elasticY(!0).elasticX(!0).renderHorizontalGridLines(!0).brushOn(!1).renderArea(!0),t.xAxis().ticks(E.time.days).tickFormat(function(e){return e.getMonth()+1+"/"+e.getDate()}),t.render()}),r.on("filter",function(e,t){var r=i.all();b(t)&&y(t[0])&&b(r)&&y(n.keyAccessor(r[0]))&&s.range(t)})}}),S.defineElement("bar",function(e){var n={keyAccessor:f("key"),valueAccessor:f("value")};return t(e,n,["keyAccessor","valueAccessor"]),function(t){var r=e.metric(),i=r.group(),s=new p(i,n.keyAccessor),o=h(e),u=t.append("div").classed("chart bar-chart",!0);r.on("ready",function(){var t=dc.barChart(u.node()).width(o.width-40).height(o.height-140).margins({top:10,right:10,bottom:30,left:60}).dimension(r.dimension()).group(s).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(c(r)).xUnits(dc.units.ordinal);t.elasticY(!0).elasticX(!0).centerBar(!0).renderHorizontalGridLines(!0).brushOn(!1),t.render()}),r.on("filter",function(e,t){var r=i.all();b(t)&&y(t[0])&&b(r)&&y(n.keyAccessor(r[0]))&&s.range(t)})}}),S.defineElement("pie",function(e){var n={donut:!1};return t(e,n,["donut"]),function(t){var n=e.metric(),r=h(e),i=t.append("div").classed("chart pie-chart",!0);n.on("ready",function(){var s=r.width/2-60,o=s*2+6,u=E.scale.linear().domain([0,n.group().size()-1]).range(["rgba(0,0,0,0.2)","rgba(0,0,0,0.7)"]),a=dc.pieChart(i.node()).width(o).height(o).radius(s).dimension(n.dimension()).group(n.group());e.donut()&&a.innerRadius(s/3),a.minAngleForLabel(.05);var f=[];for(var l=0,c=n.group().size();l<c;l++)f.push(l);a.colors(f.map(u)),a.render()})}}),S.defineElement("bubble",function(e){var n=f("value"),r={keyAccessor:f("key"),valueAccessor:f("value"),radiusAccessor:f("radius")};return t(e,r,["keyAccessor","valueAccessor","radiusAccessor"]),function(t){var r=e.metric(),i=h(e),s=l(e.keyAccessor(),n),o=l(e.valueAccessor(),n),u=l(e.radiusAccessor(),n),a=t.append("div").classed("chart bubble-chart",!0);r.on("ready",function(){var t=dc.bubbleChart(a.node()).width(i.width-40).height(i.height-140).margins({top:10,right:50,bottom:30,left:50}).dimension(r.dimension()).group(r.group()).x(c(r,s)).y(c(r,o)).r(c(r,u)).keyAccessor(s).valueAccessor(o).radiusValueAccessor(u);t.colors(E.scale.category20c()).maxBubbleRelativeSize(.09).renderLabel(!0).elasticX(!0).elasticY(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).brushOn(!1),t.render()})}}),w.informant=S})();