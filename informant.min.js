(function(){function e(e){return e instanceof C.selection?e:C.select(e)}function t(e,t,n){n.forEach(function(n){e[n]=function(r){return arguments.length?(t[n]=r,e):t[n]}})}function n(e,t,n){e[t]=function(){var t=b(arguments);return t.length?(t=T(t[0])?t[0]:t,n.forEach(function(n,r){e[n](t[r])}),e):n.map(function(t){return e[t]()})}}function r(e){e.element=function(t,n){if(A.indexOf(t)===-1)throw new Error("Unknown element type: '"+t+"'");return e[t](n)}}function i(e,t){return w(t).forEach(function(n){e[n]=t[n]}),e}function s(e){return i({},e)}function o(e,t){return S(t)&&w(t).forEach(function(n){if(!E(e[n]))throw new Error("Uknown method: '"+n+"'");e[n](t[n])}),e}function u(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(e){var t=u(e);return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}function f(e){return e===undefined}function l(e){return function(t){return t[e]}}function c(e,t){return function(n){return e(t(n))}}function h(e,t){var n=t?e.value().map(t):e.domain();return n[0]instanceof Date?C.time.scale().domain(C.extent(n)):typeof n[0]=="string"?C.scale.ordinal().domain(n):C.scale.linear().domain(C.extent(n))}function p(e){return C.time.format("%b")}function d(e){return e.getMonth()+1+"/"+e.getDate()}function v(e){return C.time.format("%I%p")}function m(e,t){var n=t[1]-t[0]||0,r=C.extent(t),i=864e5;t[0]instanceof Date&&(n<i?e.tickFormat(v):n<i*90?e.tickFormat(d):e.tickFormat(p),e.ticks(8))}function g(e){var t=(e.group?e.group():k).baseSize(),n=k.margins();return{top:t[0]*(e.top?+e.top():0)+n,left:t[1]*(e.left?+e.left():0)+n,height:t[0]*+e.height()-n*2,width:t[1]*+e.width()-n*2}}function y(e,n){var r={range:null};w(e).forEach(function(t){t!=="all"&&e.hasOwnProperty(t)&&(this[t]=function(){return e[t].apply(e,arguments)})},this),this.all=function(){var t=e.all(),i=r.range;return T(i)?t.filter(function(e){return n(e)>=i[0]&&n(e)<i[1]}):t},t(this,r,["range"])}var b=Function.prototype.call.bind(Array.prototype.slice),w=Object.keys,E=a("function"),S=a("object"),x=a("date"),T=Array.isArray,N=this,C=N.d3,k={version:"0.1.1"},L={baseWidth:1,baseHeight:1,margins:0};t(k,L,w(L)),n(k,"baseSize",["baseHeight","baseWidth"]),r(k),k.config=function(e){return arguments.length?o(k,e):s(L)};var A=[];k.defineElement=function(r,i){if(k[r])throw new Error("Attempting to define element that already exists or is protected: '"+r+"'");A.push(r),k[r]=function(s){var u,a={height:200,width:200},f=function(t){var n=g(f),i=e(t).append("div");return i.classed("element element-"+r,!0).style("height",n.height+"px").style("width",n.width+"px"),f.header()&&i.append("header").html(f.header()),i.append("div").classed("content",!0).call(u),f.footer()&&i.append("footer").html(f.footer()),f};return f.render=f,t(f,a,["metric","width","height","header","footer"]),n(f,"size",["height","width"]),u=i(f),o(f,s)}},k.group=function(){var i,u,a=[];return i=function(t){var n=e(t).append("div").classed("informant group",!0).style("position","relative");return a.forEach(function(e){var t=g(e),r=n.append("div");r.style("position","absolute").style("top",t.top+"px").style("left",t.left+"px").classed("wrapper",!0).call(e),e.id()&&r.attr("id",e.id()),e.classes()&&r.classed(e.classes(),!0)}),n},A.forEach(function(e){i[e]=function(r){var s=k[e](),u={top:0,left:0};return a.push(s),t(s,u,["id","classes","top","left"]),n(s,"position",["top","left"]),s.end=s.group=function(){return i},o(s,r),f(r)?s:i}}),u=s(L),t(i,u,w(L)),n(i,"baseSize",["baseHeight","baseWidth"]),r(i),i.render=i,i},C.interpolators.push(function(e,t){function n(e,t){return C.range(t).map(function(){return e})}function r(e){return e.substr(1,e.length-(u?2:1)).split("L")}function i(e){return"M"+e.join("L")+(u?"Z":"")}function s(e,t){var r=t.length-e.length;return u?n(e[0],r/2).concat(e,n(e[e.length-1],r/2)):n(e[0],r).concat(e)}var o,u,a,f,l,c,h;o=/M-?\d*\.?\d*,-?\d*\.?\d*(L-?\d*\.?\d*,-?\d*\.?\d*)*Z?/;if(o.test(e)&&o.test(t))return u=e[e.length-1]==="Z",f=r(e),l=r(t),c=f.length,h=l.length,c>h&&(l=s(l,f)),h>c&&(f=s(f,l)),a=C.interpolateString(h>c?i(f):e,c>h?i(l):t),h>c?a:function(e){return e===1?t:a(e)}}),k.defineElement("html",function(e){var n={content:""};return t(e,n,["content"]),delete e.metric,function(t){t.html(e.content())}}),k.defineElement("number",function(e){return function(t){var n=e.metric(),r=t.append("div").classed("value",!0);n.on("change",function(){r.text(n.value())})}}),k.defineElement("list",function(e){var n={keyAccessor:l("key"),valueAccessor:l("value"),numbered:!1,showValues:!1};return t(e,n,["keyAccessor","valueAccessor","numbered","showValues"]),function(t){var n=e.metric(),r=!!n.dimension(),i=e.keyAccessor(),s=e.valueAccessor(),o=t.append(e.numbered()?"ol":"ul");n.on("change",function(){var u=o.selectAll("li").data(n.value());u.enter().append("li").call(function(t){t.append("span").attr("class","key"),e.showValues()&&t.append("span").attr("class","value")}),u.call(function(t){t.select("span.key").text(i),e.showValues()&&t.select("span.value").text(s)}),r&&(o.classed("filterable",!0),u.classed("selected",function(e){return accessor(e)===n.filter()}).on("click",function(e){n.filter(accessor(e)===n.filter()?null:accessor(e)),dc&&dc.redrawAll()})),u.exit().remove()})}}),k.defineElement("filter",function(e){var n={source:null,filters:[],accessor:l("key")},r=[{days:90,name:"90 Day"},{days:30,name:"30 Day"},{days:7,name:"Week"},{days:1,name:"Day"}],i=864e5,s=l("filter");return t(e,n,["source","filters","accessor"]),function(t){function n(){a.selectAll("li").classed("selected",function(e){return s(e)===o.filter()})}var o=e.metric(),u=e.filters(),a=t.append("ul");if(!o){if(!e.source())throw new Error("A metric or source must be specified in a filter");o=e.source().metric().byDate()}o.on("ready",function(){if(!u.length){var f=C.extent(o.value(),e.accessor()),c=new Date(+f[1]+1),h=[f[0],c];u.push({name:"All",filter:h}),r.forEach(function(e){f[1]-f[0]>=i*e.days&&u.push({name:e.name,filter:[new Date(f[1]-i*e.days),c]})}),o.filter(h)}a.selectAll("li").data(u).enter().append("li").text(l("name")).on("click",function(e){var t=s(e);t!==o.filter()&&(o.filter(t),dc&&dc.redrawAll())}),n()}),o.on("filter",n)}}),k.defineElement("graph",function(e){var n={keyAccessor:l("key"),valueAccessor:l("value")};return t(e,n,["keyAccessor","valueAccessor"]),function(t){var r=e.metric(),i=r.group(),s=new y(i,n.keyAccessor),o=g(e),u=t.append("div").classed("chart line-chart",!0);r.on("ready",function(){var t=dc.lineChart(u.node()).width(o.width-40).height(o.height-140).margins({top:10,right:10,bottom:30,left:50}).dimension(r.dimension()).group(s).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(h(r));t.elasticY(!0).elasticX(!0).renderHorizontalGridLines(!0).brushOn(!1).renderArea(!0),m(t.xAxis(),r.domain()),t.render()}),r.on("filter",function(e,t){var r=i.all();T(t)&&x(t[0])&&T(r)&&x(n.keyAccessor(r[0]))&&s.range(t)})}}),k.defineElement("bar",function(e){var n={keyAccessor:l("key"),valueAccessor:l("value")};return t(e,n,["keyAccessor","valueAccessor"]),function(t){var r=e.metric(),i=r.group(),s=new y(i,n.keyAccessor),o=g(e),u=t.append("div").classed("chart bar-chart",!0);r.on("ready",function(){var t=dc.barChart(u.node()).width(o.width-40).height(o.height-140).margins({top:10,right:10,bottom:30,left:60}).dimension(r.dimension()).group(s).keyAccessor(n.keyAccessor).valueAccessor(n.valueAccessor).x(h(r)).xUnits(dc.units.ordinal);t.elasticY(!0).elasticX(!0).centerBar(!0).renderHorizontalGridLines(!0).brushOn(!1),t.render()}),r.on("filter",function(e,t){var r=i.all();T(t)&&x(t[0])&&T(r)&&x(n.keyAccessor(r[0]))&&s.range(t)})}}),k.defineElement("pie",function(e){var n={donut:!1};return t(e,n,["donut"]),function(t){var n=e.metric(),r=g(e),i=t.append("div").classed("chart pie-chart",!0);n.on("ready",function(){var s=r.width/2-60,o=s*2+6,u=C.scale.linear().domain([0,n.group().size()-1]).range(["rgba(0,0,0,0.2)","rgba(0,0,0,0.7)"]),a=dc.pieChart(i.node()).width(o).height(o).radius(s).dimension(n.dimension()).group(n.group());e.donut()&&a.innerRadius(s/3),a.minAngleForLabel(.05);var f=[];for(var l=0,c=n.group().size();l<c;l++)f.push(l);a.colors(f.map(u)),a.render()})}}),k.defineElement("bubble",function(e){var n=l("value"),r={keyAccessor:l("key"),valueAccessor:l("value"),radiusAccessor:l("radius")};return t(e,r,["keyAccessor","valueAccessor","radiusAccessor"]),function(t){var r=e.metric(),i=g(e),s=c(e.keyAccessor(),n),o=c(e.valueAccessor(),n),u=c(e.radiusAccessor(),n),a=t.append("div").classed("chart bubble-chart",!0);r.on("ready",function(){var t=dc.bubbleChart(a.node()).width(i.width-40).height(i.height-140).margins({top:10,right:50,bottom:30,left:50}).dimension(r.dimension()).group(r.group()).x(h(r,s)).y(h(r,o)).r(h(r,u)).keyAccessor(s).valueAccessor(o).radiusValueAccessor(u);t.colors(C.scale.category20c()).maxBubbleRelativeSize(.09).renderLabel(!0).elasticX(!0).elasticY(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).brushOn(!1),t.render()})}}),N.informant=k})();